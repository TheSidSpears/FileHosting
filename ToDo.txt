http://arhivach.org/thread/197740/#846554
https://2ch.hk/pr/res/848550.html#861976
https://2ch.hk/pr/res/848550.html#861985






Веб-сервер раскодирует процентную кодировку автоматически при поиске файла. Насчет плюса - не уверен.

Что касается кириллицы - надо быть осторожным, кодировка в URL должна совпадать с используемой кодировкой в файловой системе (в линуксе это обычно utf-8, в винде win-1251). То есть кирилицу в именах файлов на диске лучше вообще не использовать, даже вместе с процентным кодированием.

Вообще, чтобы не мучаться с именами, лучше сделать так: давать файлам на диске простые имена (только латиница и цифры например). А URL для них делать такой:

http://example.com/download/file123.txt/скачиваемое-имя.php

СОответственно в htaccess мы приписываем правило чтобы такой УРЛ перенаправлялся на файл

/download/file123.txt

А последняя часть в УРЛ нужна для того, чтобы браузер взял из нее нужное имя для сохранения файла.

Также, есть еще вариант с X-sendfile. Это расширение Апача которое может само отдавать файлы (в том числе из непублинчых папок). Там схема такая: запрос поступает к php, который определяет реальное имя файла, отдает апачу заголовок с ним и завершается. А Апач уже отдает этот файл.

То есть в таком сценарии можно сделать например УРЛ

/download/1234/имя-для-скачивания.txt

А файл реально хранится где-то в /storage/1234-some-name.txt

В любом случае принцип тут такой: браузер берет в качестве имени последний сегмент в УРЛ (то что идет от последнего слеша до конца УРЛ), при этом хранить файл мы можем под другим именем. Но в этом случае мы должны придумать механизм, как получить это настоящее имя из УРЛ. Либо оно как-то там заложено, либо там заложен id файла, а имя мы берем из базы.

При выборе имени для хранения на диске надо учесть такие моменты:

- скачиваемый файл хорошо бы сохранять с тем же именем что и закачиваемый
- разные пользователи могут загрузить 2 файла с одинаковым именем, и надо чтобы они не затерли друг друга
- если мы сохраним файл с именем x.php на диск то есть риск его выполнения. То же самое относится к файлам с именами .htaccess которые позволяют переопределить настройки сервера. Значит, нам надо гарантировать сохранение на диск с безопасным расширением
- если использовать имена в кирилице, может возникнуть проблема с тем, что в УРЛ используется utf-8, а на диске (в винде например) - другая кодировка
- желательно распределять файлы по папкам, чтобы в одной папке было не более 1000 файлов, а то трудно будет оиентироваться
- желательно делать понятные имена на диске, чтобы администратору было проще разбираться, есть что

Попробуй придумать схему, которая бы удовлетворяла этим критериям. Ну и конечно не забудь про безопасность.